
### 什么是索引？
> 数据库索引，是数据库管理系统中一个排序的数据结构，以协助快速查询、更新数据库表中数据。

### 索引常见模型
**Hash**
- 利用hash函数对key进行索引，找到数据，但是数据存储是无序的，不能使用区间查询。
- 只适用于只有等值查询的场景，适合Memcached等其他NoSql数据库

**有序数组**
等值查询和区间查询都很快，缺点是更新数据的话需要移动后面的数据。所以只适合用于静态存储引擎

**二叉树**
查找和更新都很快。缺点是，二叉树由于最多只有两个子节点，数据量很大时，树高往往很大。而且索引需要从磁盘读取到内存中的，树中的每个节点就是数据页，
每查询一次就是一次磁盘IO。IO次数跟树高度成正比，因此性能较差。
需要更少次的读取IO，需要让树变矮，就需要N叉树，即节点有更多的子节点。

#### 总结来说：
> 二叉树只有两个子节点，如果数据量很大则树就很高，树的每一层一般不在同一个数据块中存储，为了尽量的减少磁盘读写次数，我们用Ｎ叉树来代替二叉树，
在 MySQL 中这个Ｎ一般为　1200 ，这样树高是　４　的话也可以存储亿级别的数据，而且树的前面两层一般都在内存中， MySQL 中用到的　Ｂ＋　树，一般用非叶子节点构建索引，而叶子节点用来存储具体的值。


### B-Tree和B+Tree
[漫画：什么是B-树？](https://zhuanlan.zhihu.com/p/54084335)
**B-树**是一种多路平衡查找树，它的每个节点最多包含K个孩子，k称为B树的阶。k的大小取决于磁盘页的大小
一个m阶的B树具有如下几个特征：
1.根结点至少有两个子女。
2.每个中间节点都包含k-1个元素和k个孩子，其中 m/2 <= k <= m
3.每一个叶子节点都包含k-1个元素，其中 m/2 <= k <= m
4.所有的叶子结点都位于同一层。
5.每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域分划。

[漫画：什么是B+树？](https://zhuanlan.zhihu.com/p/54102723)

#### 为什么用B+树而不用B-树
- B+树非叶子节点不存储卫星数据，单一节点能够存储更多的元素，使得查询的IO次数更少
- 所有查询都要查找到叶子节点，查询性能稳定。
- 叶子节点形成有序的单向链表，方便范围查找。

#### B+树中一个节点存储多少个元素
一个节点为一页或者页的倍数最合适
- 因为如果一个节点的大小小于1页，那么读取这个节点的时候其实也会读出1页，造成资源的浪费。
- 如果一个节点的大小大于1页，比如1.2页，那么读取这个节点的时候会读出2页，也会造成资源的浪费。
- 所以为了不造成浪费，所以最后把一个节点的大小控制在1页、2页、3页、4页等倍数页大小最为合适。

**页**是MySQL基本的存储单位
![](https://mmbiz.qpic.cn/mmbiz_jpg/uChmeeX1FpwUFWcYd1A97ia8Fde0dgBM8USmoGPaPHG3OGFRbAricpEvvnp6jXXhL9JW2Y4vzNHViaNXkgqvSzPXg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)
[《爱上面试官》系列-数据库索引](https://mp.weixin.qq.com/s/_9rDde9wRYoZeh07EASNQQ)
### MySQL存储格式
[深入理解了MySQL，你才能说熟悉数据库。](https://zhuanlan.zhihu.com/p/66352669)

### 回表、覆盖索引、
**回表**
通过普通索引查询后所需要的数据只在主键索引上有，所以不得不回表

**覆盖索引**
比如通过idCardNo查找name,可以建立idCardNo和name的联合索引，这样查询name的时候就不需要回表

**最左前缀原则**
可以是联合索引的最左 N 个字段，也可以是字符串索引的最左 M 个字符。

**索引下推优化**
以联合索引(name, age)为例
```bash
mysql> select * from tuser where name like '张%' and age=10 and ismale=1;
```
在查询过程中根据name最左前缀原则找到了一组数据，然后拿到id一个个回表去匹配。

而 MySQL 5.6 引入的索引下推优化（index condition pushdown)， 可以在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数。

### 聚簇索引
聚簇索引的叶子节点存储行数据，而非聚簇索引叶子节点仍然是索引节点

MySQL InnoDB一定会建立聚簇索引，把实际数据行和相关的键值保存在一块，这也决定了一个表只能有一个聚簇索引
- 1。如果创建了一个主键，InnoDB会将其用作聚簇索引(如果主键没有逻辑唯一且非空的列或列集，最好是设置成自动递增的)

- 2。如果没有为表创建主键，则MySQL会在所有键列都不为NULL的情况下找到第一个UNIQUE索引，InnoDB会将其用作聚集索引

- 3。如果表没有PRIMARY KEY或合适的UNIQUE索引，则InnoDB在包含行ID值的合成列上内部生成一个名为GEN_CLUST_INDEX的隐藏的聚集索引(隐藏的是看不到的，也就是说不会出现在desc table中，行ID是一个6字节的字段，随着插入新行而单调增加)

从这三种情况来看的话，就是说不管你有没有创建主键，mysql都会给你弄一个聚簇索引给安排上，你创建了就用你设置的主键为聚簇索引，没有创建就给你来个隐藏的。

### 二级索引
聚簇索引的二级索引：叶子节点不会保存引用的行的物理位置，而是保存行的主键值。
### 聚集索引
聚集索引：指索引项的排序方式和表中数据记录排序方式一致的索引 
[聚簇索引与非聚簇索引（也叫二级索引）--最清楚的一篇讲解](https://cloud.tencent.com/developer/article/1541265)
